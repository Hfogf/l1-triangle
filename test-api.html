<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test L1-TRIANGLE API</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0f1419;
      color: #e0e0e0;
      padding: 2rem;
    }
    .container { max-width: 800px; margin: 0 auto; }
    h1 { color: #ff6b3d; margin-bottom: 2rem; }
    .test-box {
      background: #1a1f2e;
      border: 1px solid #ff6b3d;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .status {
      font-weight: 700;
      padding: 0.5rem;
      border-radius: 4px;
      margin: 1rem 0;
    }
    .status.ok { background: rgba(37, 211, 102, 0.2); color: #25d366; }
    .status.error { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }
    .status.pending { background: rgba(255, 193, 7, 0.2); color: #ffc107; }
    button {
      background: linear-gradient(135deg, #ff6b3d, #cc5530);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin: 0.5rem 0.5rem 0.5rem 0;
    }
    button:hover { opacity: 0.9; }
    pre {
      background: #0f1419;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      border-left: 3px solid #ff6b3d;
      margin-top: 1rem;
    }
    .product {
      background: #252d3d;
      padding: 1rem;
      border-radius: 6px;
      margin: 0.5rem 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÆ Test L1-TRIANGLE API</h1>

    <div class="test-box">
      <h2>√âtat du Serveur</h2>
      <button onclick="testServer()">Tester la connexion</button>
      <div id="server-status"></div>
    </div>

    <div class="test-box">
      <h2>Produits</h2>
      <button onclick="getProducts()">Charger les produits</button>
      <div id="products-status"></div>
      <div id="products-list"></div>
    </div>

    <div class="test-box">
      <h2>Ajouter un Produit Test</h2>
      <button onclick="addTestProduct()">Cr√©er un produit test</button>
      <div id="add-status"></div>
    </div>

    <div class="test-box">
      <h2>Shop Frontend</h2>
      <button onclick="openShop()">Ouvrir index.html</button>
      <button onclick="openAdmin()">Ouvrir admin.html</button>
      <div id="open-status"></div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/api';

    async function testServer() {
      const el = document.getElementById('server-status');
      el.innerHTML = '<div class="status pending">üîÑ Test en cours...</div>';
      
      try {
        const response = await fetch(`${API_URL}/products`, { method: 'GET' });
        if (response.ok) {
          el.innerHTML = '<div class="status ok">‚úÖ Serveur connect√©!</div>';
        } else {
          el.innerHTML = '<div class="status error">‚ùå Erreur serveur (code ' + response.status + ')</div>';
        }
      } catch (err) {
        el.innerHTML = '<div class="status error">‚ùå Serveur indisponible - Lancez START-SERVER.bat</div>';
      }
    }

    async function getProducts() {
      const el = document.getElementById('products-status');
      const list = document.getElementById('products-list');
      el.innerHTML = '<div class="status pending">üîÑ Chargement...</div>';
      list.innerHTML = '';
      
      try {
        const response = await fetch(`${API_URL}/products`);
        if (!response.ok) throw new Error('Erreur r√©seau');
        const products = await response.json();
        
        el.innerHTML = '<div class="status ok">‚úÖ ' + products.length + ' produits trouv√©s!</div>';
        list.innerHTML = products.map(p => `
          <div class="product">
            <strong>${p.title}</strong>
            <br>Prix: <span style="color: #ff6b3d">${p.price} HTG</span>
            <br>Cat√©gorie: ${p.category}
            <br>ID: ${p.id}
          </div>
        `).join('');
      } catch (err) {
        el.innerHTML = '<div class="status error">‚ùå ' + err.message + '</div>';
      }
    }

    async function addTestProduct() {
      const el = document.getElementById('add-status');
      el.innerHTML = '<div class="status pending">üîÑ Cr√©ation en cours...</div>';
      
      const testProduct = {
        title: 'Produit Test ' + new Date().getTime(),
        price: Math.floor(Math.random() * 5000) + 1000,
        category: 'test',
        desc: 'Ceci est un produit de test',
        meta: 'Stock limit√©',
        badge: 'Test',
        image: 'https://via.placeholder.com/280x200?text=Test'
      };
      
      try {
        const response = await fetch(`${API_URL}/products`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(testProduct)
        });
        
        if (!response.ok) throw new Error('Erreur cr√©ation');
        const result = await response.json();
        
        el.innerHTML = '<div class="status ok">‚úÖ Produit cr√©√© (ID: ' + result.id + ')</div>';
        getProducts();
      } catch (err) {
        el.innerHTML = '<div class="status error">‚ùå ' + err.message + '</div>';
      }
    }

    function openShop() {
      const el = document.getElementById('open-status');
      const filePath = window.location.href.replace('test-api.html', 'index.html');
      window.open(filePath, '_blank');
      el.innerHTML = '<div class="status ok">‚úÖ Ouverture de index.html...</div>';
    }

    function openAdmin() {
      const el = document.getElementById('open-status');
      const filePath = window.location.href.replace('test-api.html', 'admin.html');
      window.open(filePath, '_blank');
      el.innerHTML = '<div class="status ok">‚úÖ Ouverture de admin.html...</div>';
    }

    // Test au chargement
    window.addEventListener('load', () => {
      testServer();
      setTimeout(getProducts, 500);
    });
  </script>
</body>
</html>
